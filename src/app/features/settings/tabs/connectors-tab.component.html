<div class="connectors-tab">
  <!-- Date Range Selector -->
  <mat-card class="date-range-card">
    <mat-card-content>
      <h3>Fetch Date Range</h3>
      <div class="date-range-inputs">
        <mat-form-field appearance="outline">
          <mat-label>Start Date</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="startDate">
          <mat-datepicker-toggle matIconSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>End Date</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="endDate">
          <mat-datepicker-toggle matIconSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Configured Connectors -->
  <section class="connectors-section">
    <div class="section-header">
      <h2>Your Connectors</h2>
      <button mat-raised-button color="primary" (click)="openAddConnectorDialog()">
        <mat-icon>add</mat-icon>
        Add Connector
      </button>
    </div>

    <div class="connectors-grid" *ngIf="connectors.length > 0; else noConnectors">
      <mat-card *ngFor="let connector of connectors" class="connector-card">
        <mat-card-header>
          <mat-icon mat-card-avatar>{{ getConnectorIcon(connector.config.type) }}</mat-icon>
          <mat-card-title>{{ connector.config.name }}</mat-card-title>
          <mat-card-subtitle>{{ getConnectorTypeName(connector.config.type) }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <div class="status-container">
            <mat-chip [ngClass]="getStatusClass(connector.status)">
              <mat-icon *ngIf="isLoading(connector.status)" class="spinning">sync</mat-icon>
              {{ getStatusLabel(connector.status) }}
            </mat-chip>
          </div>

          <p class="status-message" *ngIf="connector.statusMessage">
            {{ connector.statusMessage }}
          </p>

          <div class="mfa-prompt" *ngIf="connector.status === ConnectorStatus.MFA_REQUIRED">
            <p>{{ connector.mfaChallenge?.message }}</p>
            <button mat-stroked-button color="primary" (click)="openMfaDialog(connector)">
              Enter Code
            </button>
          </div>

          <p class="last-sync" *ngIf="connector.config.lastSyncAt">
            Last sync: {{ connector.config.lastSyncAt | date:'medium' }}
          </p>
        </mat-card-content>

        <mat-card-actions>
          <ng-container [ngSwitch]="connector.status">
            <ng-container *ngSwitchCase="ConnectorStatus.DISCONNECTED">
              <button mat-button color="primary" (click)="connect(connector)">
                <mat-icon>link</mat-icon>
                Connect
              </button>
            </ng-container>

            <ng-container *ngSwitchCase="ConnectorStatus.CONNECTED">
              <button mat-button color="primary" (click)="fetchTransactions(connector)">
                <mat-icon>download</mat-icon>
                Fetch
              </button>
              <button mat-button (click)="disconnect(connector)">
                <mat-icon>link_off</mat-icon>
                Disconnect
              </button>
            </ng-container>

            <ng-container *ngSwitchCase="ConnectorStatus.CONNECTING">
              <mat-spinner diameter="24"></mat-spinner>
              <span>Connecting...</span>
            </ng-container>

            <ng-container *ngSwitchCase="ConnectorStatus.FETCHING">
              <mat-spinner diameter="24"></mat-spinner>
              <span>Fetching...</span>
            </ng-container>

            <ng-container *ngSwitchCase="ConnectorStatus.ERROR">
              <button mat-button color="warn" (click)="connect(connector)">
                <mat-icon>refresh</mat-icon>
                Retry
              </button>
            </ng-container>
          </ng-container>

          <button mat-icon-button color="warn" (click)="deleteConnector(connector)"
                  [disabled]="isLoading(connector.status)">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>
    </div>

    <ng-template #noConnectors>
      <div class="empty-state">
        <mat-icon>account_balance_wallet</mat-icon>
        <h3>No connectors configured</h3>
        <p>Add a connector to start importing transactions automatically</p>
        <button mat-raised-button color="primary" (click)="openAddConnectorDialog()">
          <mat-icon>add</mat-icon>
          Add Your First Connector
        </button>
      </div>
    </ng-template>
  </section>

  <!-- Available Connectors -->
  <section class="available-section">
    <h2>Available Connectors</h2>
    <div class="available-grid">
      <mat-card *ngFor="let available of availableConnectors" class="available-card"
                [class.not-implemented]="!available.implemented">
        <mat-card-header>
          <mat-icon mat-card-avatar>{{ available.icon }}</mat-icon>
          <mat-card-title>{{ available.name }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p>{{ available.description }}</p>
          <mat-chip *ngIf="!available.implemented" class="coming-soon">Coming Soon</mat-chip>
        </mat-card-content>
      </mat-card>
    </div>
  </section>
</div>
